{% extends "base.html" %}

{% block title %}ì»¤ë®¤ë‹ˆí‹° ìš”ì•½ ë·°ì–´ - í”„ë¡œì íŠ¸ ëª©ë¡{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #D5D9D9;
    }

    .page-title {
        font-size: 24px;
        font-weight: 700;
        margin-bottom: 8px;
    }

    .page-subtitle {
        font-size: 14px;
        color: #565959;
    }

    .project-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
    }

    .project-card {
        display: flex;
        padding: 16px;
        background-color: #fff;
        border: 1px solid #D5D9D9;
        border-radius: 8px;
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    .project-card:hover {
        border-color: #008296;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .project-card-thumbnail {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
        margin-right: 16px;
        flex-shrink: 0;
        background-color: #F7FAFA;
    }

    .project-card-content {
        flex: 1;
        min-width: 0;
    }

    .project-card-title {
        font-size: 16px;
        font-weight: 700;
        margin-bottom: 8px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .project-card-title a {
        color: #007185;
        text-decoration: none;
    }

    .project-card-title a:hover {
        color: #C7511F;
        text-decoration: underline;
    }

    .project-card-thumbnail-link {
        flex-shrink: 0;
    }

    .project-card-id {
        font-size: 12px;
        color: #565959;
        margin-bottom: 8px;
    }

    .content-type-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }

    .content-type-tag {
        display: inline-block;
        padding: 4px 8px;
        background-color: #F7FAFA;
        border: 1px solid #D5D9D9;
        border-radius: 4px;
        font-size: 12px;
        color: #007185;
        text-decoration: none;
    }

    .content-type-tag:hover {
        background-color: #E3F1F1;
        border-color: #007185;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #565959;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }

    /* í˜ì´ì§• ìŠ¤íƒ€ì¼ */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #D5D9D9;
    }

    .pagination-btn {
        padding: 8px 16px;
        border: 1px solid #D5D9D9;
        border-radius: 4px;
        background-color: #fff;
        color: #0F1111;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.2s;
    }

    .pagination-btn:hover:not(.disabled) {
        border-color: #008296;
        background-color: #F7FAFA;
    }

    .pagination-btn.active {
        border-color: #007185;
        background-color: #E7F4F5;
        color: #007185;
        font-weight: 600;
    }

    .pagination-btn.disabled {
        color: #D5D9D9;
        cursor: not-allowed;
    }

    .pagination-info {
        font-size: 14px;
        color: #565959;
        margin: 0 16px;
    }

    .page-stats {
        font-size: 14px;
        color: #565959;
        margin-bottom: 16px;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">ğŸ“Š ì»¤ë®¤ë‹ˆí‹° ìš”ì•½ ë·°ì–´{% if provider %} ({{ provider|upper }}){% endif %}</h1>
    <p class="page-subtitle">Elasticsearchì— ì €ì¥ëœ ì½˜í…ì¸  ë¶„ì„ ê²°ê³¼ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
</div>

{% if projects %}
<div class="page-stats">
    ì „ì²´ {{ total_count }}ê°œ í”„ë¡œì íŠ¸ ì¤‘ {{ (page - 1) * 20 + 1 }} - {{ (page - 1) * 20 + projects|length }}ë²ˆì§¸
</div>

<div class="project-list">
    {% for project in projects %}
    <div class="project-card">
        {% if project.link %}
        <a href="{{ project.link }}" target="_blank" class="project-card-thumbnail-link">
            {% if project.thumbnail_url %}
            <img src="{{ project.thumbnail_url }}" alt="ì¸ë„¤ì¼" class="project-card-thumbnail">
            {% else %}
            <div class="project-card-thumbnail"></div>
            {% endif %}
        </a>
        {% else %}
            {% if project.thumbnail_url %}
            <img src="{{ project.thumbnail_url }}" alt="ì¸ë„¤ì¼" class="project-card-thumbnail">
            {% else %}
            <div class="project-card-thumbnail"></div>
            {% endif %}
        {% endif %}
        <div class="project-card-content">
            <div class="project-card-title">
                {% if project.link %}
                <a href="{{ project.link }}" target="_blank">{{ project.title or 'ì œëª© ì—†ìŒ' }}</a>
                {% else %}
                {{ project.title or 'ì œëª© ì—†ìŒ' }}
                {% endif %}
            </div>
            <div class="project-card-id">í”„ë¡œì íŠ¸ ID: {{ project.id }}</div>
            <div class="content-type-tags">
                {% for ct in project.content_types %}
                {% if provider == 'vertex-ai' %}
                <a href="{{ url_for('viewer_vertex_ai_detail', project_id=project.id) }}?content_type={{ ct }}" class="content-type-tag">{{ ct }}</a>
                {% elif provider == 'openai' %}
                <a href="{{ url_for('viewer_openai_detail', project_id=project.id) }}?content_type={{ ct }}" class="content-type-tag">{{ ct }}</a>
                {% else %}
                <a href="{{ url_for('viewer_detail', project_id=project.id) }}?content_type={{ ct }}" class="content-type-tag">{{ ct }}</a>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{# í˜ì´ì§• UI #}
{% if total_pages > 1 %}
{# Providerë³„ list route ê²°ì • #}
{% if provider == 'vertex-ai' %}
    {% set list_route = 'viewer_vertex_ai_list' %}
{% elif provider == 'openai' %}
    {% set list_route = 'viewer_openai_list' %}
{% else %}
    {% set list_route = 'viewer_list' %}
{% endif %}
<div class="pagination">
    {# ì´ì „ ë²„íŠ¼ #}
    {% if page > 1 %}
    <a href="{{ url_for(list_route) }}?page={{ page - 1 }}" class="pagination-btn">â† ì´ì „</a>
    {% else %}
    <span class="pagination-btn disabled">â† ì´ì „</span>
    {% endif %}

    {# í˜ì´ì§€ ë²ˆí˜¸ #}
    {% set start_page = [1, page - 2]|max %}
    {% set end_page = [total_pages, page + 2]|min %}

    {% if start_page > 1 %}
    <a href="{{ url_for(list_route) }}?page=1" class="pagination-btn">1</a>
    {% if start_page > 2 %}<span class="pagination-info">...</span>{% endif %}
    {% endif %}

    {% for p in range(start_page, end_page + 1) %}
    <a href="{{ url_for(list_route) }}?page={{ p }}"
       class="pagination-btn {% if p == page %}active{% endif %}">{{ p }}</a>
    {% endfor %}

    {% if end_page < total_pages %}
    {% if end_page < total_pages - 1 %}<span class="pagination-info">...</span>{% endif %}
    <a href="{{ url_for(list_route) }}?page={{ total_pages }}" class="pagination-btn">{{ total_pages }}</a>
    {% endif %}

    {# ë‹¤ìŒ ë²„íŠ¼ #}
    {% if page < total_pages %}
    <a href="{{ url_for(list_route) }}?page={{ page + 1 }}" class="pagination-btn">ë‹¤ìŒ â†’</a>
    {% else %}
    <span class="pagination-btn disabled">ë‹¤ìŒ â†’</span>
    {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <div class="empty-state-icon">ğŸ“­</div>
    <p>ì €ì¥ëœ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
</div>
{% endif %}

<div class="footer">
    Generated by Content AI Agent | Wadiz
</div>
{% endblock %}
