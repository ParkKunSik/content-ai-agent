{% extends "task/base.jinja2" %}

{% block content %}
{#
    [상세 분석 정제 프롬프트 - 2단계: 요약 최적화]
    
    설명:
    요약 정제 전문 프롬프트로, 상세한 분석 데이터를 받아 요약 길이를 최적화하여
    간결하고 핵심적인 인사이트만 남깁니다. 이전 단계나 다른 상태에 영향을 받지 않습니다.
    
    번역:
    # 작업: 요약 정제 및 길이 최적화
    
    제공된 상세 분석 데이터의 요약 길이를 최적화하십시오.
    
    ## 정제 요구사항
    
    ### 1. 요약 길이 제약
    - 메인 요약: 최대 {{ max_main_summary_chars }}자
    - 카테고리 요약: 각각 최대 {{ max_category_summary_chars }}자
    - 핵심 본질: 이러한 제한 내에서 가장 중요한 인사이트를 포착
    
    ### 2. 요약 최적화 가이드라인
    - 영향도 우선순위: 가장 중요한 발견사항에 집중
    - 중복 제거: 반복되는 개념이나 불필요한 단어 제거
    - 명확성 유지: 축약된 텍스트가 여전히 이해 가능하도록 보장
    - 핵심 지표 보존: 가능한 한 중요한 통계나 패턴 포함
    - 완전한 서술: 응집력 있는 문단으로 작성, 요약에서 개조식 피하기
    - 통합된 인사이트: 장점과 단점을 자연스러운 흐름으로 매끄럽게 결합
    
    ## 입력 데이터
    
    프로젝트 ID: {{ project_id }}
    프로젝트 타입: {{ project_type }}
    
    분석 데이터:
    ```json
    {{ raw_analysis_data }}
    ```
    
    ## 출력 형식

    다음 구조를 가진 유효한 JSON 객체이어야 합니다:
    {{ response_schema }}

    **필수 JSON 생성 규칙**:
    1. **문자열 Escape 처리**: 모든 문자열 값은 특수문자를 반드시 escape 처리해야 함:
       - 큰따옴표: `"` → `\"`
       - 백슬래시: `\` → `\\`
       - 줄바꿈: `\n` → `\\n` (또는 공백으로 대체)
       - 탭: `\t` → `\\t` (또는 공백으로 대체)
       - 캐리지 리턴: `\r` → `\\r` (또는 제거)
    2. **문자열 값에 줄바꿈 금지**: 모든 문자열 값을 한 줄로 유지
    3. **유효한 JSON만**: 표준 JSON 파서로 파싱 가능하도록 보장

    **문체 및 품질 요구사항**:
    - 격식을 갖춘 문서체: 비즈니스 맥락에 적합한 전문적이고 정중한 언어 사용
    - 완전한 문단: 개조식이 아닌 응집력 있는 서술체로 요약 작성
    - 통합된 분석: 긍정적이고 부정적인 측면을 자연스러운 흐름으로 결합
    - 문자 제한: 메인 요약 {{ max_main_summary_chars }}자, 카테고리 요약 {{ max_category_summary_chars }}자 엄격 준수
    - 데이터 무결성 보존: category_key 값을 제공된 그대로 정확히 유지 (수정 금지)

    **중요**: 최적화된 요약 길이로 정제된 JSON 객체만 반환하십시오
#}

# Task: Summary Refinement and Length Optimization

Optimize the summary lengths of the provided detailed analysis data.

## Refinement Requirements

### 1. Summary Length Constraints
- **Main summary**: Maximum {{ max_main_summary_chars }} characters
- **Category summaries**: Maximum {{ max_category_summary_chars }} characters each
- **Core essence**: Capture the most important insights within these limits

### 2. Summary Optimization Guidelines
- **Prioritize impact**: Focus on the most significant findings
- **Remove redundancy**: Eliminate repeated concepts or filler words
- **Maintain clarity**: Ensure abbreviated text remains understandable
- **Preserve key metrics**: Include important statistics or patterns when possible
- **Complete narrative**: Write as cohesive paragraphs, avoid bullet points in summaries
- **Integrated insights**: Seamlessly combine strengths and weaknesses into natural flow

## Input Data

Project ID: {{ project_id }}
Project Type: {{ project_type }}

Analysis Data:
```json
{{ raw_analysis_data }}
```

## Output Format

Output must be a valid JSON object with the following structure:
{{ response_schema }}

**CRITICAL JSON Generation Rules**:
1. **String Escaping**: All string values MUST properly escape special characters:
   - Double quotes: `"` → `\"`
   - Backslashes: `\` → `\\`
   - Newlines: `\n` → `\\n` (or replace with space)
   - Tabs: `\t` → `\\t` (or replace with space)
   - Carriage returns: `\r` → `\\r` (or remove)
2. **No Line Breaks in String Values**: Keep all string values on a single line
3. **Valid JSON Only**: Ensure the output is parseable by standard JSON parsers

**Writing Style & Quality Requirements**:
- **Formal written style**: Use professional, polite language suitable for business contexts
- **Complete paragraphs**: Write summaries as cohesive narratives, not bullet points
- **Integrated analysis**: Combine positive and negative aspects into natural flow
- **Character limits**: Strictly enforce {{ max_main_summary_chars }}-character main summary, {{ max_category_summary_chars }}-character category summaries
- **Preserve data integrity**: Keep category_key values exactly as provided (do not modify)

**Important**: Return ONLY the refined JSON object with optimized summary lengths
{% endblock %}